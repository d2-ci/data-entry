{"version":3,"sources":["D2App/context-selection/attribute-option-combo-selector-bar-item/categories-menu.module.css","D2App/context-selection/menu-select/menu-select.module.css","D2App/context-selection/org-unit-selector-bar-item/org-unit-selector-bar-item.module.css","D2App/shared/error-message/error-message.module.css","D2App/context-selection/period-selector-bar-item/period-menu.module.css","D2App/context-selection/period-selector-bar-item/year-navigator.module.css","D2App/app/layout/layout.module.css","D2App/context-selection/use-context-selection/use-context-selection.js","D2App/context-selection/attribute-option-combo-selector-bar-item/use-category-combination.js","D2App/context-selection/attribute-option-combo-selector-bar-item/categories-menu.js","D2App/context-selection/attribute-option-combo-selector-bar-item/use-selected.js","D2App/context-selection/attribute-option-combo-selector-bar-item/attribute-option-combo-selector-bar-item.js","D2App/context-selection/attribute-option-combo-selector-bar-item/omit.js","D2App/context-selection/attribute-option-combo-selector-bar-item/use-should-component-render-null.js","D2App/context-selection/attribute-option-combo-selector-bar-item/use-selector-bar-item-label.js","D2App/context-selection/attribute-option-combo-selector-bar-item/use-selector-bar-item-value.js","D2App/context-selection/attribute-option-combo-selector-bar-item/use-on-dependent-params-change.js","D2App/context-selection/menu-select/menu-select.js","D2App/context-selection/data-set-selector-bar-item/use-data-set.js","D2App/context-selection/data-set-selector-bar-item/use-selectable-data-sets.js","D2App/context-selection/data-set-selector-bar-item/data-set-selector-bar-item.js","D2App/context-selection/org-unit-selector-bar-item/debounced-search-input.js","D2App/context-selection/org-unit-selector-bar-item/use-debounce.js","D2App/context-selection/org-unit-selector-bar-item/disabled-tooltip.js","D2App/context-selection/org-unit-selector-bar-item/use-data-set-org-unit-paths.js","D2App/context-selection/org-unit-selector-bar-item/use-org-unit-paths-by-name.js","D2App/context-selection/org-unit-selector-bar-item/use-organisation-unit.js","D2App/context-selection/org-unit-selector-bar-item/use-user-org-units.js","D2App/context-selection/org-unit-selector-bar-item/org-unit-selector-bar-item.js","D2App/context-selection/org-unit-selector-bar-item/use-expanded-state.js","D2App/context-selection/org-unit-selector-bar-item/use-select-bar-item-value.js","D2App/context-selection/org-unit-selector-bar-item/get-filtered-org-unit-paths.js","D2App/shared/fixed-periods/fixed-periods.js","D2App/shared/period/use-period.js","D2App/context-selection/period-selector-bar-item/compute-max-year.js","D2App/context-selection/period-selector-bar-item/get-most-recent-completed-year.js","D2App/context-selection/period-selector-bar-item/period-menu.js","D2App/context-selection/period-selector-bar-item/use-data-set-period-type.js","D2App/context-selection/period-selector-bar-item/year-navigator.js","D2App/context-selection/period-selector-bar-item/period-selector-bar-item.js","D2App/context-selection/period-selector-bar-item/use-select-bar-item-value.js","D2App/context-selection/period-selector-bar-item/use-deselect-on-period-type-change.js","D2App/context-selection/section-filter-selector-bar-item/use-data-set-sections-info.js","D2App/context-selection/section-filter-selector-bar-item/section-filter-selector-bar-item.js","D2App/context-selection/section-filter-selector-bar-item/use-selector-bar-item-value.js","D2App/context-selection/section-filter-selector-bar-item/use-on-dependent-params-change.js","D2App/context-selection/section-filter-selector-bar-item/use-should-component-render-null.js","D2App/context-selection/context-selection/context-selection.js","D2App/context-selection/context-selection/use-should-hide-clear-button.js","D2App/app/layout/layout.js","D2App/app/use-query-client.js","D2App/app/app.js"],"names":["module","exports","PARAMS_SCHEMA","dataSetId","StringParam","orgUnitId","periodId","attributeOptionComboSelection","withDefault","ArrayParam","sectionFilter","useDataSetId","useQueryParam","useOrgUnitId","usePeriodId","useAttributeOptionComboSelection","useSectionFilter","useContextSelection","useQueryParams","QUERY_CATEGORY_COMBINATION","dataSet","resource","id","_ref","params","fields","useCategoryCombination","queryKey","isIdle","isLoading","loading","error","data","useQuery","enabled","called","categoryCombo","CategoriesMenu","_categoryCombination$","close","selected","onChange","categoryCombination","i18n","t","React","createElement","className","css","container","inputs","categories","map","_ref2","displayName","categoryOptions","input","key","SingleSelectField","label","_ref3","categoryId","_ref4","SingleSelectOption","value","Button","secondary","onClick","_","evt","stopPropagation","createStateFromUrlParam","urlParams","reduce","acc","cur","split","AttributeOptionComboSelectorBarItem","open","setOpen","useState","deselectAll","select","setAttributeOptionComboSelection","setSelected","useEffect","nextSelected","collection","nextCollection","omit","nextAttributeOptionComboSelection","Object","entries","concat","useSelected","shouldComponentRenderNull","_categoryCombination$2","length","isDefault","useShouldComponentRenderNull","nsSeparator","useSelectorBarItemLabel","valueLabel","Error","console","useSelectorBarItemValue","cb","initialExecution","useRef","current","useOnDependentParamsChange","renderMenu","SelectorBarItem","noValueMessage","MenuSelect","values","menuSelect","Menu","MenuItem","active","QUERY_DATA_SET","QUERY_SELECTABLE_DATA_SETS","dataSets","paging","DataSetSelectorBarItem","_dataSet$data","dataSetOpen","setDataSetOpen","setDataSetId","useDataSet","selectableDataSets","_data$dataSets","useSelectableDataSets","selectorBarItemValue","undefined","DebouncedSearchInput","setValue","debouncedValue","delay","setDebouncedValue","handler","setTimeout","clearTimeout","useDebounce","InputField","dense","name","placeholder","nextValue","DisabledTooltip","children","tooltipContent","Tooltip","content","ref","onMouseOver","onMouseOut","QUERY_DATA_SET_ORG_UNIT_PATHS","useDataSetOrgUnitPaths","organisationUnits","path","QUERY_SEARCH_ORG_UNITS","orgUnits","searchTerm","filter","QUERY_ORG_UNIT","orgUnit","useOrgUnit","QUERY_USER_ORG_UNITS","useUserOrgUnits","RootLoading","CircularLoader","small","_JSXStyle","RootError","ERRORMESSAGE","OrganisationUnitSetSelectorBarItem","setFilter","orgUnitPathsByName","useMemo","useOrgUnitPathsByName","orgUnitOpen","setOrgUnitOpen","expanded","handleExpand","handleCollapse","setExpanded","p","useExpandedState","setOrgUnitId","userOrgUnits","dataSetOrgUnitPaths","_orgUnit$data","disabled","filteredOrgUnitPaths","dataSetPaths","includes","getFilteredOrgUnitPaths","orgUnitPathsByNameLoading","itemContentContainer","searchInputContainer","orgUnitTreeContainer","OrganisationUnitTree","singleSelection","roots","e","DAILY","WEEKLY","WEEKLY_WEDNESDAY","WEEKLY_THURSDAY","WEEKLY_SATURDAY","WEEKLY_SUNDAY","BI_WEEKLY","MONTHLY","BI_MONTHLY","QUARTERLY","SIX_MONTHLY","SIX_MONTHLY_APRIL","YEARLY","FINANCIAL_APRIL","FINANCIAL_JULY","FINANCIAL_OCT","FINANCIAL_NOV","PERIOD_TYPES","Set","isValidPeriodType","periodType","has","getMonthName","getCurrentDate","Date","now","getYearWithOffset","offset","offsetInt","parseInt","getFullYear","getDailyPeriodType","formatYyyyMmDd","fnFilter","config","periods","isFilter","filterFuturePeriods","isReverse","reversePeriods","year","date","period","startDate","endDate","iso","replace","push","setDate","getDate","reverse","getWeeklyPeriodType","weekObj","startDayOfWeek","arguments","jan4","jan4DayOfWeek","getDay","dayDiff","getEpiWeekStartDay","startDay","week","shortName","weekNumber","getBiWeeklyPeriodType","day","biWeek","biWeekNumber","getMonthlyPeriodType","formatIso","y","m","String","getMonth","monthName","getBiMonthlyPeriodType","index","monthStart","monthEnd","fullYear","getQuarterlyPeriodType","quarter","getSixMonthlyPeriodType","getSixMonthlyAprilPeriodType","getYearlyPeriodType","setMonth","dateString","toString","getFinancialOctoberPeriodType","i","setYear","yearStart","yearEnd","getFinancialNovemberPeriodType","getFinancialJulyPeriodType","getFinancialAprilPeriodType","defaultFormatYyyyMmDd","d","defaultFilterFuturePeriods","array","getFixedPeriodTypes","type","regex","getPeriods","getYearOffsetFromNow","yearInt","Number","isInteger","getFixedPeriodsByTypeAndYear","fixedPeriod","periodTypeObj","find","getFixedPeriodType","isValidDate","isNaN","getTime","getFixedPeriodsForTypeAndDateRange","startDateReached","convertedPeriods","forEach","periodEnd","endsAfterPeriodStart","usePeriod","allowedTypes","periodTypes","some","allowedType","match","parsePeriodId","computeMaxYear","getMostRecentCompletedYear","PeriodMenu","selectedPeriod","systemInfo","dateFormat","useConfig","moment","format","toUpperCase","classes","menu","useDataSetPeriodType","YearNavigator","maxYear","onYearChange","icon","IconArrowLeft24","IconArrowRight24","PeriodSelectorBarItem","periodOpen","setPeriodOpen","setPeriodId","dataSetPeriodType","setMaxYear","newMaxYear","previousPeriodType","setPreviousPeriodType","loadingDataSetPeriodType","errorDataSetPeriodType","useDeselectOnPeriodTypeChange","Fragment","QUERY_DATA_SET_SECTIONS_INFO","useDataSetSectionsInfo","SectionFilterSelectorBarItem","_dataSetSectionsInfo$","setSectionFilter","dataSetSectionsInfo","sectionFilterValue","sections","selectedSection","_dataSetSectionsInfo$2","formType","sectionOptions","selectableOptions","ContextSelector","hideClearButton","selection","useShouldHideClearButton","clearEntireSelection","setSelectionContext","useCallback","useClearEntireSelection","onClearSelectionClick","SelectorBar","OrgUnitSetSelectorBarItem","Layout","header","main","sidebar","footer","showSidebar","showFooter","wrapperClass","classnames","wrapper","useQueryClient","engine","useDataEngine","QueryClient","defaultOptions","queries","queryFn","query","variables","App","queryClient","QueryClientProvider","client","Router","QueryParamProvider","ReactRouterRoute","Route","CssVariables","colors","spacers","ContextSelection"],"mappings":"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","file":"static/js/app.8eda481c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"categories-menu_container__gcKJ6\",\"inputs\":\"categories-menu_inputs__23WFq\",\"input\":\"categories-menu_input__LOiJY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"menuSelect\":\"menu-select_menuSelect__2wY8M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"itemContentContainer\":\"org-unit-selector-bar-item_itemContentContainer__2CxCn\",\"searchInputContainer\":\"org-unit-selector-bar-item_searchInputContainer__Oxf6u\",\"orgUnitTreeContainer\":\"org-unit-selector-bar-item_orgUnitTreeContainer__1JGBG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"error-message_wrapper__17C15\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"menu\":\"period-menu_menu__CKEQa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"year-navigator_container__3tWfA\",\"year\":\"year-navigator_year__1-oYj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"layout_wrapper__t4ys_\",\"showSidebar\":\"layout_showSidebar__3kRCf\",\"showFooter\":\"layout_showFooter__2QEnR\",\"header\":\"layout_header__32xI8\",\"main\":\"layout_main__tku6I\",\"sidebar\":\"layout_sidebar__2JyT-\",\"footer\":\"layout_footer__3RbA5\"};","import { useCallback } from 'react';\nimport { ArrayParam, StringParam, useQueryParams, useQueryParam, withDefault } from 'use-query-params';\nconst PARAMS_SCHEMA = {\n  dataSetId: StringParam,\n  orgUnitId: StringParam,\n  periodId: StringParam,\n  attributeOptionComboSelection: withDefault(ArrayParam, []),\n  sectionFilter: StringParam\n};\nexport function useDataSetId() {\n  return useQueryParam('dataSetId', PARAMS_SCHEMA.dataSetId);\n}\nexport function useOrgUnitId() {\n  return useQueryParam('orgUnitId', PARAMS_SCHEMA.orgUnitId);\n}\nexport function usePeriodId() {\n  return useQueryParam('periodId', PARAMS_SCHEMA.periodId);\n}\nexport function useAttributeOptionComboSelection() {\n  return useQueryParam('attributeOptionComboSelection', PARAMS_SCHEMA.attributeOptionComboSelection);\n}\nexport function useSectionFilter() {\n  return useQueryParam('sectionFilter', PARAMS_SCHEMA.sectionFilter);\n}\nexport function useContextSelection() {\n  return useQueryParams(PARAMS_SCHEMA);\n}\nexport function useClearEntireSelection() {\n  const [, setSelectionContext] = useContextSelection();\n  return useCallback(() => {\n    setSelectionContext({\n      dataSetId: '',\n      orgUnitId: '',\n      periodId: '',\n      attributeOptionComboSelection: [],\n      sectionFilter: ''\n    });\n  }, [setSelectionContext]);\n}","import { useQuery } from 'react-query';\nimport { useDataSetId } from '../use-context-selection/index.js';\nconst QUERY_CATEGORY_COMBINATION = {\n  dataSet: {\n    resource: 'dataSets',\n    id: _ref => {\n      let {\n        id\n      } = _ref;\n      return id;\n    },\n    params: {\n      fields: ['categoryCombo[isDefault,displayName, categories[id, displayName, categoryOptions[id, displayName]]]']\n    }\n  }\n};\nexport default function useCategoryCombination() {\n  const [dataSetId] = useDataSetId();\n  const queryKey = [QUERY_CATEGORY_COMBINATION, {\n    id: dataSetId\n  }];\n  const {\n    isIdle,\n    isLoading: loading,\n    error,\n    data\n  } = useQuery(queryKey, {\n    enabled: !!dataSetId\n  });\n  return {\n    called: !isIdle,\n    loading,\n    error,\n    data: data === null || data === void 0 ? void 0 : data.dataSet.categoryCombo\n  };\n}","import i18n from '@dhis2/d2-i18n';\nimport { Button, SingleSelectField, SingleSelectOption } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport css from './categories-menu.module.css';\nimport useCategoryCombination from './use-category-combination.js';\nexport default function CategoriesMenu(_ref) {\n  var _categoryCombination$;\n\n  let {\n    close,\n    selected,\n    onChange\n  } = _ref;\n  const categoryCombination = useCategoryCombination();\n\n  if (!categoryCombination.called || categoryCombination.loading) {\n    return i18n.t('Loading categories...');\n  }\n\n  if (categoryCombination.error) {\n    return i18n.t('An error occurred loading the categories');\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: css.container\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: css.inputs\n  }, (_categoryCombination$ = categoryCombination.data) === null || _categoryCombination$ === void 0 ? void 0 : _categoryCombination$.categories.map(_ref2 => {\n    let {\n      id,\n      displayName,\n      categoryOptions\n    } = _ref2;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: css.input,\n      key: id\n    }, /*#__PURE__*/React.createElement(SingleSelectField, {\n      label: displayName,\n      selected: selected[id],\n      onChange: _ref3 => {\n        let {\n          selected\n        } = _ref3;\n        return onChange({\n          categoryId: id,\n          selected\n        });\n      }\n    }, categoryOptions.map(_ref4 => {\n      let {\n        id,\n        displayName\n      } = _ref4;\n      return /*#__PURE__*/React.createElement(SingleSelectOption, {\n        key: id,\n        value: id,\n        label: displayName\n      });\n    })));\n  })), /*#__PURE__*/React.createElement(Button, {\n    secondary: true,\n    onClick: (_, evt) => {\n      // required as otherwise it'd trigger a `setOpen(true)` call as\n      // react thinks of this dropdown as being inside of the\n      // selector. A click on the selector opens the menu.\n      evt.stopPropagation();\n      close();\n    }\n  }, i18n.t('Hide menu')));\n}\nCategoriesMenu.propTypes = {\n  close: PropTypes.func.isRequired,\n  selected: PropTypes.objectOf(PropTypes.string).isRequired,\n  onChange: PropTypes.func.isRequired\n};","import { useEffect, useState } from 'react';\nimport { useAttributeOptionComboSelection } from '../use-context-selection/index.js';\nimport omit from './omit.js';\n\nconst createStateFromUrlParam = urlParams => {\n  return urlParams.reduce((acc, cur) => {\n    const [key, value] = cur.split(':');\n    return { ...acc,\n      [key]: value\n    };\n  }, {});\n};\n\nexport default function useSelected() {\n  const [attributeOptionComboSelection, setAttributeOptionComboSelection] = useAttributeOptionComboSelection();\n  const [selected, setSelected] = useState(() => createStateFromUrlParam(attributeOptionComboSelection));\n  useEffect(() => {\n    setSelected(createStateFromUrlParam(attributeOptionComboSelection));\n  }, [attributeOptionComboSelection]);\n\n  const deselectAll = () => {\n    setSelected({});\n    setAttributeOptionComboSelection([]);\n  };\n\n  const select = _ref => {\n    let {\n      value,\n      categoryId\n    } = _ref;\n    const nextSelected = !value ? omit(categoryId, selected) : { ...selected,\n      [categoryId]: value\n    };\n    const nextAttributeOptionComboSelection = Object.entries(nextSelected).map(_ref2 => {\n      let [key, value] = _ref2;\n      return \"\".concat(key, \":\").concat(value);\n    });\n    setSelected(nextSelected);\n    setAttributeOptionComboSelection(nextAttributeOptionComboSelection);\n  };\n\n  return {\n    select,\n    selected,\n    deselectAll\n  };\n}","import i18n from '@dhis2/d2-i18n';\nimport { SelectorBarItem } from '@dhis2/ui';\nimport React, { useState } from 'react';\nimport CategoriesMenu from './categories-menu.js';\nimport useCategoryCombination from './use-category-combination.js';\nimport useOnDependentParamsChange from './use-on-dependent-params-change.js';\nimport useSelected from './use-selected.js';\nimport useSelectorBarItemLabel from './use-selector-bar-item-label.js';\nimport useSelectorBarItemValue from './use-selector-bar-item-value.js';\nimport useShouldComponentRenderNull from './use-should-component-render-null.js';\nexport default function AttributeOptionComboSelectorBarItem() {\n  const [open, setOpen] = useState(false);\n  const categoryCombination = useCategoryCombination();\n  const {\n    deselectAll,\n    select,\n    selected\n  } = useSelected();\n  const shouldComponentRenderNull = useShouldComponentRenderNull();\n  const label = useSelectorBarItemLabel();\n  const valueLabel = useSelectorBarItemValue();\n\n  const onChange = _ref => {\n    let {\n      selected,\n      categoryId\n    } = _ref;\n    return select({\n      value: selected,\n      categoryId\n    });\n  };\n\n  useOnDependentParamsChange(deselectAll);\n\n  if (shouldComponentRenderNull) {\n    return null;\n  }\n\n  const renderMenu = categoryCombination.called && !categoryCombination.loading && !categoryCombination.error && categoryCombination.data;\n  return /*#__PURE__*/React.createElement(SelectorBarItem, {\n    label: label,\n    value: valueLabel,\n    open: open,\n    setOpen: setOpen,\n    noValueMessage: i18n.t('Choose a data set')\n  }, categoryCombination.error && i18n.t('An error occurred loading the categories'), renderMenu && /*#__PURE__*/React.createElement(CategoriesMenu, {\n    close: () => setOpen(false),\n    selected: selected,\n    onChange: onChange\n  }));\n}","export default function omit(key, collection) {\n  const nextCollection = { ...collection\n  };\n  delete nextCollection[key];\n  return nextCollection;\n}","import { useDataSetId, useOrgUnitId, usePeriodId } from '../use-context-selection/index.js';\nimport useCategoryCombination from './use-category-combination.js';\n/*\n * `categoryCombination.loading` does not mean that \"null\" should be rendered.\n * This happens automatically during the first loading as\n * `!categoryCombination.data?.categories.length` resolves to `true`.\n *\n * But when data is stale and this function has determined that the component\n * should not render `null`, then it's most likely not going to change when\n * reloading\n */\n\nexport default function useShouldComponentRenderNull() {\n  var _categoryCombination$, _categoryCombination$2;\n\n  const [dataSetId] = useDataSetId();\n  const [periodId] = usePeriodId();\n  const [orgUnitId] = useOrgUnitId();\n  const categoryCombination = useCategoryCombination();\n  return !dataSetId || !periodId || !orgUnitId || !categoryCombination.called || !((_categoryCombination$ = categoryCombination.data) !== null && _categoryCombination$ !== void 0 && _categoryCombination$.categories.length) || ((_categoryCombination$2 = categoryCombination.data) === null || _categoryCombination$2 === void 0 ? void 0 : _categoryCombination$2.isDefault);\n}","import i18n from '@dhis2/d2-i18n';\nimport useCategoryCombination from './use-category-combination.js';\nexport default function useSelectorBarItemLabel() {\n  var _categoryCombination$;\n\n  const categoryCombination = useCategoryCombination();\n\n  if (!categoryCombination.called || categoryCombination.loading) {\n    return i18n.t('Loading categories...');\n  }\n\n  if (categoryCombination.error) {\n    return i18n.t('Attribute option combination: An error occurred', {\n      nsSeparator: '-:-'\n    });\n  }\n\n  return (_categoryCombination$ = categoryCombination.data) === null || _categoryCombination$ === void 0 ? void 0 : _categoryCombination$.displayName;\n}","import i18n from '@dhis2/d2-i18n';\nimport { useAttributeOptionComboSelection } from '../use-context-selection/index.js';\nimport useCategoryCombination from './use-category-combination.js';\nexport default function useSelectorBarItemValue() {\n  const [attributeOptionComboSelection] = useAttributeOptionComboSelection();\n  const categoryCombination = useCategoryCombination();\n\n  if (!categoryCombination.called || categoryCombination.loading) {\n    return i18n.t('Loading...');\n  }\n\n  if (categoryCombination.error) {\n    return i18n.t('An error loading the values occurred');\n  }\n\n  if (!attributeOptionComboSelection.length) {\n    return i18n.t('No selection!');\n  }\n\n  if (categoryCombination.data && attributeOptionComboSelection.length < categoryCombination.data.categories.length) {\n    return i18n.t('Partial selection!');\n  }\n\n  if (categoryCombination.data && attributeOptionComboSelection.length === categoryCombination.data.categories.length) {\n    return i18n.t('Complete selection!');\n  }\n\n  const error = new Error('Case not implemented!');\n\n  if (process.env.NODE_ENV !== 'production') {\n    throw error;\n  } else {\n    console.error(error);\n  }\n\n  return '';\n}","import { useEffect, useRef } from 'react';\nimport { useDataSetId, useOrgUnitId, usePeriodId } from '../use-context-selection/index.js';\nexport default function useOnDependentParamsChange(cb) {\n  const initialExecution = useRef(true);\n  const [dataSetId] = useDataSetId();\n  const [periodId] = usePeriodId();\n  const [orgUnitId] = useOrgUnitId();\n  useEffect(() => {\n    if (initialExecution.current) {\n      initialExecution.current = false;\n    } else {\n      cb();\n    }\n  }, [dataSetId, orgUnitId, periodId]);\n}","import { Menu, MenuItem } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport css from './menu-select.module.css';\nexport default function MenuSelect(_ref) {\n  let {\n    values,\n    selected,\n    onChange\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: css.menuSelect\n  }, /*#__PURE__*/React.createElement(Menu, null, values.map(_ref2 => {\n    let {\n      value,\n      label\n    } = _ref2;\n    return /*#__PURE__*/React.createElement(MenuItem, {\n      key: value,\n      label: label,\n      active: selected === value,\n      onClick: () => onChange({\n        selected: value\n      })\n    });\n  })));\n}\nMenuSelect.propTypes = {\n  values: PropTypes.arrayOf(PropTypes.shape({\n    label: PropTypes.string.isRequired,\n    value: PropTypes.string.isRequired\n  })).isRequired,\n  onChange: PropTypes.func.isRequired,\n  selected: PropTypes.string\n};","import { useQuery } from 'react-query';\nimport { useDataSetId } from '../use-context-selection/index.js';\nconst QUERY_DATA_SET = {\n  dataSet: {\n    resource: 'dataSets',\n    id: _ref => {\n      let {\n        id\n      } = _ref;\n      return id;\n    },\n    params: {\n      fields: ['id', 'displayName']\n    }\n  }\n};\nexport default function useDataSet() {\n  const [dataSetId] = useDataSetId();\n  const {\n    isIdle,\n    isLoading: loading,\n    error,\n    data\n  } = useQuery([QUERY_DATA_SET, {\n    id: dataSetId\n  }], {\n    enabled: !!dataSetId\n  });\n  return {\n    called: !isIdle,\n    loading,\n    error,\n    data: data === null || data === void 0 ? void 0 : data.dataSet\n  };\n}","import { useQuery } from 'react-query';\nconst QUERY_SELECTABLE_DATA_SETS = {\n  dataSets: {\n    resource: 'dataSets',\n    params: {\n      paging: false\n    }\n  }\n};\nexport default function useSelectableDataSets() {\n  var _data$dataSets;\n\n  const {\n    isIdle,\n    isLoading: loading,\n    error,\n    data\n  } = useQuery([QUERY_SELECTABLE_DATA_SETS]); // @TODO: How to handle pages / large lists?\n  // Nested as this is \"page-able\"\n\n  const selectableDataSets = data === null || data === void 0 ? void 0 : (_data$dataSets = data.dataSets) === null || _data$dataSets === void 0 ? void 0 : _data$dataSets.dataSets.map(dataSet => ({ ...dataSet,\n    // Making sure these can be options as well\n    value: dataSet.id,\n    label: dataSet.displayName\n  }));\n  return {\n    called: !isIdle,\n    loading,\n    error,\n    data: selectableDataSets\n  };\n}","import i18n from '@dhis2/d2-i18n';\nimport { SelectorBarItem } from '@dhis2/ui';\nimport React, { useState } from 'react';\nimport { MenuSelect } from '../menu-select/index.js';\nimport { useDataSetId } from '../use-context-selection/index.js';\nimport useDataSet from './use-data-set.js';\nimport useSelectableDataSets from './use-selectable-data-sets.js';\nexport default function DataSetSelectorBarItem() {\n  var _dataSet$data;\n\n  const [dataSetOpen, setDataSetOpen] = useState(false);\n  const [dataSetId, setDataSetId] = useDataSetId();\n  const dataSet = useDataSet();\n  const selectableDataSets = useSelectableDataSets();\n  const selectorBarItemValue = dataSet.loading ? i18n.t('Fetching data set info') : dataSet.error ? i18n.t('Error occurred while loading data set info') : (_dataSet$data = dataSet.data) === null || _dataSet$data === void 0 ? void 0 : _dataSet$data.displayName;\n  const renderMenu = selectableDataSets.called && !selectableDataSets.loading && !selectableDataSets.error && selectableDataSets.data;\n  return /*#__PURE__*/React.createElement(SelectorBarItem, {\n    label: i18n.t('Data set'),\n    value: dataSetId ? selectorBarItemValue : undefined,\n    open: dataSetOpen,\n    setOpen: setDataSetOpen,\n    noValueMessage: i18n.t('Choose a data set')\n  }, selectableDataSets.loading && i18n.t('Fetching data sets'), selectableDataSets.error && i18n.t('Error occurred while loading data sets'), renderMenu && /*#__PURE__*/React.createElement(MenuSelect, {\n    values: selectableDataSets.data,\n    selected: dataSetId,\n    onChange: _ref => {\n      let {\n        selected\n      } = _ref;\n      setDataSetId(selected);\n      setDataSetOpen(false);\n    }\n  }));\n}","import i18n from '@dhis2/d2-i18n';\nimport { InputField } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useState } from 'react';\nimport useDebounce from './use-debounce.js';\nexport default function DebouncedSearchInput(_ref) {\n  let {\n    onChange\n  } = _ref;\n  const [value, setValue] = useState('');\n  const debouncedValue = useDebounce(value, 200);\n  useEffect(() => {\n    onChange(debouncedValue);\n  }, [onChange, debouncedValue]);\n  return /*#__PURE__*/React.createElement(InputField, {\n    dense: true,\n    value: value,\n    name: \"context-selection-org-unit-search\",\n    placeholder: i18n.t('Search org units'),\n    onChange: _ref2 => {\n      let {\n        value: nextValue\n      } = _ref2;\n      return setValue(nextValue);\n    }\n  });\n}\nDebouncedSearchInput.propTypes = {\n  onChange: PropTypes.func.isRequired\n};","import { useEffect, useState } from 'react';\n/** Copied from https://usehooks.com/useDebounce/ */\n\nexport default function useDebounce(value, delay) {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n  useEffect(() => {\n    const handler = setTimeout(() => setDebouncedValue(value), delay);\n    return () => clearTimeout(handler);\n  }, [value, delay]);\n  return debouncedValue;\n}","import i18n from '@dhis2/d2-i18n';\nimport { Tooltip } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { useDataSetId } from '../use-context-selection/index.js';\nexport default function DisabledTooltip(_ref) {\n  let {\n    children\n  } = _ref;\n  const [dataSetId] = useDataSetId();\n  const tooltipContent = !dataSetId ? i18n.t('You must choose a data set first') : undefined;\n\n  if (!tooltipContent) {\n    return children;\n  }\n\n  return /*#__PURE__*/React.createElement(Tooltip, {\n    content: tooltipContent\n  }, _ref2 => {\n    let {\n      ref,\n      onMouseOver,\n      onMouseOut\n    } = _ref2;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      ref: ref,\n      onMouseOver: onMouseOver,\n      onMouseOut: onMouseOut\n    }, children);\n  });\n}\nDisabledTooltip.propTypes = {\n  children: PropTypes.any.isRequired\n};","import { useQuery } from 'react-query';\nimport { useDataSetId } from '../use-context-selection/index.js';\nconst QUERY_DATA_SET_ORG_UNIT_PATHS = {\n  dataSet: {\n    resource: 'dataSets',\n    id: _ref => {\n      let {\n        id\n      } = _ref;\n      return id;\n    },\n    params: {\n      fields: ['organisationUnits[path]']\n    }\n  }\n};\nexport default function useDataSetOrgUnitPaths() {\n  const [dataSetId] = useDataSetId();\n  const queryKey = [QUERY_DATA_SET_ORG_UNIT_PATHS, {\n    id: dataSetId\n  }];\n  const {\n    isLoading: loading,\n    error,\n    data\n  } = useQuery(queryKey, {\n    enabled: !!dataSetId\n  });\n  const dataSetOrgUnitPaths = data === null || data === void 0 ? void 0 : data.dataSet.organisationUnits.map(_ref2 => {\n    let {\n      path\n    } = _ref2;\n    return path;\n  });\n  return {\n    data: dataSetOrgUnitPaths,\n    loading,\n    error\n  };\n}","import { useMemo } from 'react';\nimport { useQuery } from 'react-query';\nconst QUERY_SEARCH_ORG_UNITS = {\n  orgUnits: {\n    resource: 'organisationUnits',\n    params: _ref => {\n      let {\n        searchTerm\n      } = _ref;\n      return {\n        fields: ['path'],\n        filter: \"displayName:ilike:\".concat(searchTerm),\n        paging: false\n      };\n    }\n  }\n};\nexport default function useOrgUnitPathsByName(searchTerm) {\n  const queryKey = [QUERY_SEARCH_ORG_UNITS, {\n    searchTerm\n  }];\n  const {\n    isIdle,\n    isLoading: loading,\n    error,\n    data\n  } = useQuery(queryKey, {\n    enabled: !!searchTerm\n  });\n  const paths = useMemo(() => {\n    if (!data) {\n      return [];\n    }\n\n    return data.orgUnits.organisationUnits.map(_ref2 => {\n      let {\n        path\n      } = _ref2;\n      return path;\n    });\n  }, [data]);\n  return {\n    called: !isIdle,\n    loading,\n    error,\n    data: paths\n  };\n}","import { useQuery } from 'react-query';\nimport { useOrgUnitId } from '../use-context-selection/index.js';\nconst QUERY_ORG_UNIT = {\n  orgUnit: {\n    resource: 'organisationUnits',\n    id: _ref => {\n      let {\n        id\n      } = _ref;\n      return id;\n    },\n    params: {\n      fields: ['id', 'displayName', 'path']\n    }\n  }\n};\nexport default function useOrgUnit() {\n  const [orgUnitId] = useOrgUnitId();\n  const queryKey = [QUERY_ORG_UNIT, {\n    id: orgUnitId\n  }];\n  const {\n    isLoading: loading,\n    error,\n    data\n  } = useQuery(queryKey, {\n    enabled: !!orgUnitId\n  });\n  const orgUnit = data === null || data === void 0 ? void 0 : data.orgUnit;\n  return {\n    loading,\n    error,\n    data: orgUnitId ? orgUnit : undefined\n  };\n}","import { useQuery } from 'react-query';\nconst QUERY_USER_ORG_UNITS = {\n  orgUnits: {\n    resource: 'me',\n    params: {\n      fields: ['organisationUnits[id]']\n    }\n  }\n};\nexport default function useUserOrgUnits() {\n  const {\n    isLoading: loading,\n    error,\n    data\n  } = useQuery([QUERY_USER_ORG_UNITS]);\n  const userOrgUnits = data === null || data === void 0 ? void 0 : data.orgUnits.organisationUnits.map(_ref => {\n    let {\n      id\n    } = _ref;\n    return id;\n  });\n  return {\n    data: userOrgUnits,\n    loading,\n    error\n  };\n}","import _JSXStyle from \"styled-jsx/style\";\nimport i18n from '@dhis2/d2-i18n';\nimport { CircularLoader, OrganisationUnitTree, SelectorBarItem } from '@dhis2/ui';\nimport React, { useState } from 'react';\nimport { useAttributeOptionComboSelection, useDataSetId, useOrgUnitId } from '../use-context-selection/index.js';\nimport DebouncedSearchInput from './debounced-search-input.js';\nimport DisabledTooltip from './disabled-tooltip.js';\nimport getFilteredOrgUnitPaths from './get-filtered-org-unit-paths.js';\nimport css from './org-unit-selector-bar-item.module.css';\nimport useDataSetOrgUnitPaths from './use-data-set-org-unit-paths.js';\nimport useExpandedState from './use-expanded-state.js';\nimport useOrgUnitPathsByName from './use-org-unit-paths-by-name.js';\nimport useOrgUnit from './use-organisation-unit.js';\nimport useSelectorBarItemValue from './use-select-bar-item-value.js';\nimport useUserOrgUnits from './use-user-org-units.js'; // @TODO: Expose this component in the UI library\n\nconst RootLoading = () => /*#__PURE__*/React.createElement(\"div\", {\n  \"data-test\": \"-loading\",\n  className: \"jsx-814846266\"\n}, /*#__PURE__*/React.createElement(CircularLoader, {\n  small: true\n}), /*#__PURE__*/React.createElement(_JSXStyle, {\n  id: \"814846266\"\n}, [\"div.jsx-814846266{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}\"])); // @TODO: Expose this component in the UI library\n\n\nconst RootError = (_ref // eslint-disable-line\n) => {\n  let {\n    error\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    \"data-test\": \"-error\"\n  }, i18n.t('Error: {{ ERRORMESSAGE }}', {\n    ERRORMESSAGE: error,\n    nsSeparator: '>'\n  }));\n};\n\nexport default function OrganisationUnitSetSelectorBarItem() {\n  const [filter, setFilter] = useState('');\n  const orgUnitPathsByName = useOrgUnitPathsByName(filter);\n  const [orgUnitOpen, setOrgUnitOpen] = useState(false);\n  const {\n    expanded,\n    handleExpand,\n    handleCollapse\n  } = useExpandedState();\n  const [dataSetId] = useDataSetId();\n  const [, setOrgUnitId] = useOrgUnitId();\n  const [, setAttributeOptionComboSelection] = useAttributeOptionComboSelection();\n  const orgUnit = useOrgUnit();\n  const userOrgUnits = useUserOrgUnits(); // @TODO: Figure out how to only use org units that are connected to the\n  // data set. Currently the api only returns paths for the units on the\n  // lowest level, Task: Figure out if only the lowest levels should be\n  // selectable, if the levels above are missing from the response or whether\n  // all parent units are automatically selectable as well\n\n  const dataSetOrgUnitPaths = useDataSetOrgUnitPaths();\n  const selectorBarItemValue = useSelectorBarItemValue();\n  const selected = orgUnit.data ? [orgUnit.data.path] : [];\n  const disabled = !dataSetId;\n  const filteredOrgUnitPaths = getFilteredOrgUnitPaths({\n    filter,\n    orgUnitPathsByName: orgUnitPathsByName.data,\n    dataSetOrgUnitPaths: dataSetOrgUnitPaths.data\n  });\n  const orgUnitPathsByNameLoading = // Either a filter has been set but the hook\n  // hasn't been called yet\n  filter !== '' && !orgUnitPathsByName.called || // or it's actually loading\n  orgUnitPathsByName.loading;\n  return /*#__PURE__*/React.createElement(DisabledTooltip, null, /*#__PURE__*/React.createElement(SelectorBarItem, {\n    disabled: disabled,\n    label: i18n.t('Organisation unit'),\n    value: selectorBarItemValue,\n    open: orgUnitOpen,\n    setOpen: setOrgUnitOpen,\n    noValueMessage: i18n.t('Choose a organisation unit')\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: css.itemContentContainer\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: css.searchInputContainer\n  }, /*#__PURE__*/React.createElement(DebouncedSearchInput, {\n    onChange: setFilter\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: css.orgUnitTreeContainer\n  }, orgUnitPathsByNameLoading && /*#__PURE__*/React.createElement(RootLoading, null), !orgUnitPathsByNameLoading && orgUnitPathsByName.error && /*#__PURE__*/React.createElement(RootError, {\n    error: orgUnitPathsByName.error\n  }), !orgUnitPathsByNameLoading && !!filter && !filteredOrgUnitPaths.length && i18n.t('No organisation units could be found'), !orgUnitPathsByNameLoading && (!filter || !!filteredOrgUnitPaths.length) && /*#__PURE__*/React.createElement(OrganisationUnitTree, {\n    singleSelection: true,\n    filter: filteredOrgUnitPaths,\n    roots: userOrgUnits.data || [],\n    selected: selected,\n    expanded: expanded,\n    handleExpand: handleExpand,\n    handleCollapse: handleCollapse,\n    onChange: (_ref2, e) => {\n      let {\n        id\n      } = _ref2;\n      // Not sure why this is necessary, but when not done,\n      // it causes bugs in the UI\n      e.stopPropagation();\n      setOrgUnitId(id);\n      setOrgUnitOpen(false);\n      setAttributeOptionComboSelection([]);\n    }\n  })))));\n}","import { useState } from 'react';\nexport default function useExpandedState() {\n  const [expanded, setExpanded] = useState([]);\n\n  const handleExpand = _ref => {\n    let {\n      path\n    } = _ref;\n    return setExpanded([...expanded, path]);\n  };\n\n  const handleCollapse = _ref2 => {\n    let {\n      path\n    } = _ref2;\n    return setExpanded(expanded.filter(p => p !== path));\n  };\n\n  return {\n    expanded,\n    handleExpand,\n    handleCollapse\n  };\n}","import i18n from '@dhis2/d2-i18n';\nimport useDataSetOrgUnitPaths from './use-data-set-org-unit-paths.js';\nimport useOrgUnit from './use-organisation-unit.js';\nimport useUserOrgUnits from './use-user-org-units.js';\nexport default function useSelectorBarItemValue() {\n  var _orgUnit$data;\n\n  const orgUnit = useOrgUnit();\n  const userOrgUnits = useUserOrgUnits();\n  const dataSetOrgUnitPaths = useDataSetOrgUnitPaths();\n\n  if (userOrgUnits.loading || orgUnit.loading || dataSetOrgUnitPaths.loading) {\n    return i18n.t('Fetching organisation unit info');\n  }\n\n  if (orgUnit.error || userOrgUnits.error || dataSetOrgUnitPaths.error) {\n    return i18n.t('Error occurred while loading organisation unit info');\n  }\n\n  return (_orgUnit$data = orgUnit.data) === null || _orgUnit$data === void 0 ? void 0 : _orgUnit$data.displayName;\n}","export default function getFilteredOrgUnitPaths(_ref) {\n  let {\n    filter,\n    orgUnitPathsByName,\n    dataSetOrgUnitPaths\n  } = _ref;\n  const dataSetPaths = dataSetOrgUnitPaths || []; // If user didn't filter, return all possible paths\n\n  if (!filter) {\n    return dataSetPaths;\n  }\n\n  const filterPaths = filter !== '' ? orgUnitPathsByName : []; // Only return paths that are allowed by the data set\n\n  return filterPaths.filter(path => dataSetPaths.includes(path));\n}","import i18n from '@dhis2/d2-i18n';\n/*\n * This code is copied from the analytics repo as a temporary solution.\n * https://github.com/dhis2/analytics/tree/master/src/components/PeriodDimension/utils\n * In the long term, this period related logic should be moved into its own repo, see:\n * https://jira.dhis2.org/browse/LIBS-193\n * The following changes to the code in the anaytics repo have been implemented:\n *   A. Renamed period-CODE to period-ID\n *   B. Adjusted period type names (values) to match the names in the response from `api/periodTypes`\n *   C. Adjusted period type variable names to equivalent of B, but in UPPER_SNAKE_CASE\n * IMO these changes should be implemented in the period package too\n */\n// Period types\n\nconst DAILY = 'Daily';\nconst WEEKLY = 'Weekly';\nconst WEEKLY_WEDNESDAY = 'WeeklyWednesday';\nconst WEEKLY_THURSDAY = 'WeeklyThursday';\nconst WEEKLY_SATURDAY = 'WeeklySaturday';\nconst WEEKLY_SUNDAY = 'WeeklySunday';\nconst BI_WEEKLY = 'BiWeekly';\nconst MONTHLY = 'Monthly';\nconst BI_MONTHLY = 'BiMonthly';\nconst QUARTERLY = 'Quarterly';\nconst SIX_MONTHLY = 'SixMonthly';\nconst SIX_MONTHLY_APRIL = 'SixMonthlyApril'; // const SIX_MONTHLY_NOV = 'SixMonthlyNov'\n\nconst YEARLY = 'Yearly';\nconst FINANCIAL_APRIL = 'FinancialApril';\nconst FINANCIAL_JULY = 'FinancialJuly';\nconst FINANCIAL_OCT = 'FinancialOct';\nconst FINANCIAL_NOV = 'FinancialNov';\nconst PERIOD_TYPES = new Set([DAILY, WEEKLY, WEEKLY_WEDNESDAY, WEEKLY_THURSDAY, WEEKLY_SATURDAY, WEEKLY_SUNDAY, BI_WEEKLY, MONTHLY, BI_MONTHLY, QUARTERLY, SIX_MONTHLY, SIX_MONTHLY_APRIL, YEARLY, FINANCIAL_APRIL, FINANCIAL_JULY, FINANCIAL_OCT, FINANCIAL_NOV]);\nexport const isValidPeriodType = periodType => PERIOD_TYPES.has(periodType);\n\nconst getMonthName = key => {\n  const monthNames = [i18n.t('January'), i18n.t('February'), i18n.t('March'), i18n.t('April'), i18n.t('May'), i18n.t('June'), i18n.t('July'), i18n.t('August'), i18n.t('September'), i18n.t('October'), i18n.t('November'), i18n.t('December')];\n  return monthNames[key];\n};\n/**\n * Initialise a Date instance with Date.now() for Jest mocking.\n * This can be removed once we upgrade Jest to a verion which\n * supports `jest.setSystemTime`.\n */\n\n\nexport const getCurrentDate = () => new Date(Date.now());\nexport const getYearWithOffset = offset => {\n  const offsetInt = parseInt(offset, 10) || 0;\n  return getCurrentDate().getFullYear() + offsetInt;\n};\n\nconst getDailyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"01 Jan \".concat(year));\n\n    while (date.getFullYear() === year) {\n      const period = {};\n      period.startDate = formatYyyyMmDd(date);\n      period.endDate = period.startDate;\n      period.displayName = period.startDate;\n      period.iso = period.startDate.replace(/-/g, '');\n      period.id = period.iso;\n      periods.push(period);\n      date.setDate(date.getDate() + 1);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods.reverse() : periods;\n    return periods;\n  };\n};\n\nconst getWeeklyPeriodType = (formatYyyyMmDd, weekObj, fnFilter) => {\n  // Calculate the first date of an EPI year base on ISO standard  ( first week always contains 4th Jan )\n  const getEpiWeekStartDay = function (year) {\n    let startDayOfWeek = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    const jan4 = new Date(year, 0, 4);\n    const jan4DayOfWeek = jan4.getDay();\n    const startDate = jan4;\n    const dayDiff = jan4DayOfWeek - startDayOfWeek;\n\n    if (dayDiff > 0) {\n      startDate.setDate(jan4.getDate() - dayDiff);\n    } else if (dayDiff < 0) {\n      startDate.setDate(jan4.getDate() - dayDiff);\n      startDate.setDate(startDate.getDate() - 7);\n    }\n\n    return startDate;\n  };\n\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = getEpiWeekStartDay(year, weekObj.startDay);\n    let week = 1;\n\n    while (date.getFullYear() <= year) {\n      const period = {};\n      period.startDate = formatYyyyMmDd(date);\n      period.iso = \"\".concat(year).concat(weekObj.shortName, \"W\").concat(week);\n      period.id = period.iso;\n      date.setDate(date.getDate() + 6);\n      period.endDate = formatYyyyMmDd(date);\n      const weekNumber = week;\n      period.displayName = \"\".concat(i18n.t('Week {{weekNumber}}', {\n        weekNumber\n      }), \" - \").concat(period.startDate, \" - \").concat(period.endDate); // if end date is Jan 4th or later, week belongs to next year\n\n      if (date.getFullYear() > year && date.getDate() >= 4) {\n        break;\n      }\n\n      periods.push(period);\n      date.setDate(date.getDate() + 1);\n      week += 1;\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods.reverse() : periods;\n    return periods;\n  };\n};\n\nconst getBiWeeklyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"01 Jan \".concat(year));\n    const day = date.getDay();\n    let biWeek = 1;\n\n    if (day <= 4) {\n      date.setDate(date.getDate() - (day - 1));\n    } else {\n      date.setDate(date.getDate() + (8 - day));\n    }\n\n    while (date.getFullYear() <= year) {\n      const period = {};\n      period.iso = \"\".concat(year, \"BiW\").concat(biWeek);\n      period.id = period.iso;\n      period.startDate = formatYyyyMmDd(date);\n      date.setDate(date.getDate() + 13);\n      period.endDate = formatYyyyMmDd(date);\n      const biWeekNumber = biWeek;\n      period.displayName = \"\".concat(i18n.t('Bi-Week {{biWeekNumber}}', {\n        biWeekNumber\n      }), \" - \").concat(period.startDate, \" - \").concat(period.endDate); // if end date is Jan 4th or later, biweek belongs to next year\n\n      if (date.getFullYear() > year && date.getDate() >= 4) {\n        break;\n      }\n\n      periods.push(period);\n      date.setDate(date.getDate() + 1);\n      biWeek += 1;\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods.reverse() : periods;\n    return periods;\n  };\n};\n\nconst getMonthlyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  const formatIso = date => {\n    const y = date.getFullYear();\n    let m = String(date.getMonth() + 1);\n    m = m.length < 2 ? \"0\".concat(m) : m;\n    return y + m;\n  };\n\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"31 Dec \".concat(year));\n\n    while (date.getFullYear() === year) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setDate(1);\n      period.startDate = formatYyyyMmDd(date);\n      const monthName = getMonthName(date.getMonth());\n      period.displayName = \"\".concat(monthName, \" \").concat(year);\n      period.iso = formatIso(date);\n      period.id = period.iso;\n      periods.push(period);\n      date.setDate(0);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // Months are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getBiMonthlyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"31 Dec \".concat(year));\n    let index = 6;\n\n    while (date.getFullYear() === year) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setDate(0);\n      date.setDate(1);\n      period.startDate = formatYyyyMmDd(date);\n      const monthStart = getMonthName(date.getMonth());\n      const monthEnd = getMonthName(date.getMonth() + 1);\n      const fullYear = date.getFullYear();\n      period.displayName = \"\".concat(monthStart, \" - \").concat(monthEnd, \" \").concat(fullYear);\n      period.iso = \"\".concat(year, \"0\").concat(index, \"B\");\n      period.id = period.iso;\n      periods.push(period);\n      date.setDate(0);\n      index--;\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // Bi-months are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getQuarterlyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"31 Dec \".concat(year));\n    let quarter = 4;\n\n    while (date.getFullYear() === year) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setDate(0);\n      date.setDate(0);\n      date.setDate(1);\n      period.startDate = formatYyyyMmDd(date);\n      const monthStart = getMonthName(date.getMonth());\n      const monthEnd = getMonthName(date.getMonth() + 2);\n      const fullYear = date.getFullYear();\n      period.displayName = \"\".concat(monthStart, \" - \").concat(monthEnd, \" \").concat(fullYear);\n      period.iso = \"\".concat(year, \"Q\").concat(quarter);\n      period.id = period.iso;\n      periods.push(period);\n      date.setDate(0);\n      quarter -= 1;\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // Quarters are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getSixMonthlyPeriodType = fnFilter => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    let period = {};\n    period.startDate = \"\".concat(year, \"-01-01\");\n    period.endDate = \"\".concat(year, \"-06-30\");\n    period.displayName = \"\".concat(getMonthName(0), \" - \").concat(getMonthName(5), \" \").concat(year);\n    period.iso = \"\".concat(year, \"S1\");\n    period.id = period.iso;\n    periods.push(period);\n    period = {};\n    period.startDate = \"\".concat(year, \"-07-01\");\n    period.endDate = \"\".concat(year, \"-12-31\");\n    period.displayName = \"\".concat(getMonthName(6), \" - \").concat(getMonthName(11), \" \").concat(year);\n    period.iso = \"\".concat(year, \"S2\");\n    period.id = period.iso;\n    periods.push(period);\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods.reverse() : periods;\n    return periods;\n  };\n};\n\nconst getSixMonthlyAprilPeriodType = fnFilter => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    let period = {};\n    period.startDate = \"\".concat(year, \"-04-01\");\n    period.endDate = \"\".concat(year, \"-09-30\");\n    period.displayName = \"\".concat(getMonthName(3), \" - \").concat(getMonthName(8), \" \").concat(year);\n    period.iso = \"\".concat(year, \"AprilS1\");\n    period.id = period.iso;\n    periods.push(period);\n    period = {};\n    period.startDate = \"\".concat(year, \"-10-01\");\n    period.endDate = \"\".concat(year + 1, \"-03-31\");\n    period.displayName = \"\".concat(getMonthName(9), \" \").concat(year, \" - \").concat(getMonthName(2), \" \").concat(year + 1);\n    period.iso = \"\".concat(year, \"AprilS2\");\n    period.id = period.iso;\n    periods.push(period);\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods.reverse() : periods;\n    return periods;\n  };\n};\n\nconst getYearlyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"31 Dec \".concat(year));\n\n    while (year - date.getFullYear() < 10) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setMonth(0, 1);\n      period.startDate = formatYyyyMmDd(date);\n      const dateString = date.getFullYear().toString();\n      period.displayName = dateString;\n      period.iso = date.getFullYear().toString();\n      period.id = period.iso.toString();\n      periods.push(period);\n      date.setDate(0);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // Years are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getFinancialOctoberPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"30 Sep \".concat(year + 1));\n\n    for (let i = 0; i < 10; i++) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setYear(date.getFullYear() - 1);\n      date.setDate(date.getDate() + 1);\n      period.startDate = formatYyyyMmDd(date);\n      const yearStart = date.getFullYear();\n      const yearEnd = date.getFullYear() + 1;\n      period.displayName = \"\".concat(getMonthName(9), \" \").concat(yearStart, \" - \").concat(getMonthName(8), \" \").concat(yearEnd);\n      period.id = \"\".concat(date.getFullYear(), \"Oct\");\n      periods.push(period);\n      date.setDate(date.getDate() - 1);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // FinancialOctober periods are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getFinancialNovemberPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"31 Oct \".concat(year + 1));\n\n    for (let i = 0; i < 10; i++) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setYear(date.getFullYear() - 1);\n      date.setDate(date.getDate() + 1);\n      period.startDate = formatYyyyMmDd(date);\n      const yearStart = date.getFullYear();\n      const yearEnd = date.getFullYear() + 1;\n      period.displayName = \"\".concat(getMonthName(10), \" \").concat(yearStart, \" - \").concat(getMonthName(9), \" \").concat(yearEnd);\n      period.id = \"\".concat(date.getFullYear(), \"Nov\");\n      periods.push(period);\n      date.setDate(date.getDate() - 1);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // FinancialNovember periods are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getFinancialJulyPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"30 Jun \".concat(year + 1));\n\n    for (let i = 0; i < 10; i++) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setYear(date.getFullYear() - 1);\n      date.setDate(date.getDate() + 1);\n      period.startDate = formatYyyyMmDd(date);\n      const yearStart = date.getFullYear();\n      const yearEnd = date.getFullYear() + 1;\n      period.displayName = \"\".concat(getMonthName(6), \" \").concat(yearStart, \" - \").concat(getMonthName(5), \" \").concat(yearEnd);\n      period.id = \"\".concat(date.getFullYear(), \"July\");\n      periods.push(period);\n      date.setDate(date.getDate() - 1);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // FinancialJuly periods are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst getFinancialAprilPeriodType = (formatYyyyMmDd, fnFilter) => {\n  return config => {\n    let periods = [];\n    const isFilter = config.filterFuturePeriods;\n    const isReverse = config.reversePeriods;\n    const year = getYearWithOffset(config.offset);\n    const date = new Date(\"31 Mar \".concat(year + 1));\n\n    for (let i = 0; i < 10; i++) {\n      const period = {};\n      period.endDate = formatYyyyMmDd(date);\n      date.setYear(date.getFullYear() - 1);\n      date.setDate(date.getDate() + 1);\n      period.startDate = formatYyyyMmDd(date);\n      const yearStart = date.getFullYear();\n      const yearEnd = date.getFullYear() + 1;\n      period.displayName = \"\".concat(getMonthName(3), \" \").concat(yearStart, \" - \").concat(getMonthName(2), \" \").concat(yearEnd);\n      period.id = \"\".concat(date.getFullYear(), \"April\");\n      periods.push(period);\n      date.setDate(date.getDate() - 1);\n    }\n\n    periods = isFilter ? fnFilter(periods) : periods;\n    periods = isReverse ? periods : periods.reverse(); // FinancialApril periods are collected backwards. If isReverse is true, then do nothing. Else reverse to correct order and return.\n\n    return periods;\n  };\n};\n\nconst defaultFormatYyyyMmDd = date => {\n  const y = date.getFullYear();\n  let m = String(date.getMonth() + 1);\n  let d = String(date.getDate());\n  m = m.length < 2 ? \"0\".concat(m) : m;\n  d = d.length < 2 ? \"0\".concat(d) : d;\n  return \"\".concat(y, \"-\").concat(m, \"-\").concat(d);\n};\n\nconst defaultFilterFuturePeriods = periods => {\n  const array = [];\n  const now = getCurrentDate();\n\n  for (let i = 0; i < periods.length; i++) {\n    if (new Date(periods[i].startDate) <= now) {\n      array.push(periods[i]);\n    }\n  }\n\n  return array;\n};\n\nexport const getFixedPeriodTypes = function () {\n  let {\n    formatYyyyMmDd = defaultFormatYyyyMmDd,\n    filterFuturePeriods = defaultFilterFuturePeriods\n  } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return [{\n    type: DAILY,\n    regex: /^([0-9]{4})([0-9]{2})([0-9]{2})$/,\n    // YYYYMMDD\n    getPeriods: getDailyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Daily')\n  }, {\n    type: WEEKLY,\n    regex: /^([0-9]{4})()W([0-9]{1,2})$/,\n    // YYYY\"W\"[1-53]\n    getPeriods: getWeeklyPeriodType(formatYyyyMmDd, {\n      shortName: '',\n      startDay: 1\n    }, filterFuturePeriods),\n    displayName: i18n.t('Weekly')\n  }, {\n    type: WEEKLY_WEDNESDAY,\n    regex: /^([0-9]{4})(Wed)W([0-9]{1,2})$/,\n    // YYYY\"WedW\"[1-53]\n    getPeriods: getWeeklyPeriodType(formatYyyyMmDd, {\n      shortName: 'Wed',\n      startDay: 3\n    }, filterFuturePeriods),\n    displayName: i18n.t('Weekly (Start Wednesday)')\n  }, {\n    type: WEEKLY_THURSDAY,\n    regex: /^([0-9]{4})(Thu)W([0-9]{1,2})$/,\n    // YYYY\"ThuW\"[1-53]\n    getPeriods: getWeeklyPeriodType(formatYyyyMmDd, {\n      shortName: 'Thu',\n      startDay: 4\n    }, filterFuturePeriods),\n    displayName: i18n.t('Weekly (Start Thursday)')\n  }, {\n    type: WEEKLY_SATURDAY,\n    regex: /^([0-9]{4})(Sat)W([0-9]{1,2})$/,\n    // YYYY\"SatW\"[1-53]\n    getPeriods: getWeeklyPeriodType(formatYyyyMmDd, {\n      shortName: 'Sat',\n      startDay: 6\n    }, filterFuturePeriods),\n    displayName: i18n.t('Weekly (Start Saturday)')\n  }, {\n    type: WEEKLY_SUNDAY,\n    regex: /^([0-9]{4})(Sun)W([0-9]{1,2})$/,\n    // YYYY\"SunW\"[1-53]\n    getPeriods: getWeeklyPeriodType(formatYyyyMmDd, {\n      shortName: 'Sun',\n      startDay: 7\n    }, filterFuturePeriods),\n    displayName: i18n.t('Weekly (Start Sunday)')\n  }, {\n    type: BI_WEEKLY,\n    regex: /^([0-9]{4})BiW([0-9]{1,2})$/,\n    // YYYY\"BiW\"[1-27]\n    getPeriods: getBiWeeklyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Bi-weekly')\n  }, {\n    type: MONTHLY,\n    regex: /^([0-9]{4})([0-9]{2})$/,\n    // YYYYMM\n    getPeriods: getMonthlyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Monthly')\n  }, {\n    type: BI_MONTHLY,\n    regex: /^([0-9]{4})([0-9]{2})B$/,\n    // YYYY0[1-6]\"B\"\n    getPeriods: getBiMonthlyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Bi-monthly')\n  }, {\n    type: QUARTERLY,\n    regex: /^([0-9]{4})Q([1234])$/,\n    // YYYY\"Q\"[1-4]\n    getPeriods: getQuarterlyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Quarterly')\n  }, {\n    type: SIX_MONTHLY,\n    regex: /^([0-9]{4})S([12])$/,\n    // YYYY\"S\"[1/2]\n    getPeriods: getSixMonthlyPeriodType(filterFuturePeriods),\n    displayName: i18n.t('Six-monthly')\n  }, {\n    type: SIX_MONTHLY_APRIL,\n    regex: /^([0-9]{4})AprilS([12])$/,\n    // YYYY\"AprilS\"[1/2]\n    getPeriods: getSixMonthlyAprilPeriodType(filterFuturePeriods),\n    displayName: i18n.t('Six-monthly April')\n  }, {\n    type: YEARLY,\n    regex: /^([0-9]{4})$/,\n    // YYYY\n    getPeriods: getYearlyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Yearly')\n  }, {\n    type: FINANCIAL_NOV,\n    regex: /^([0-9]{4})Nov$/,\n    // YYYY\"Nov\"\n    getPeriods: getFinancialNovemberPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Financial year (Start November)')\n  }, {\n    type: FINANCIAL_OCT,\n    regex: /^([0-9]{4})Oct$/,\n    // YYYY\"Oct\"\n    getPeriods: getFinancialOctoberPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Financial year (Start October)')\n  }, {\n    type: FINANCIAL_JULY,\n    regex: /^([0-9]{4})July$/,\n    // YYYY\"July\"\n    getPeriods: getFinancialJulyPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Financial year (Start July)')\n  }, {\n    type: FINANCIAL_APRIL,\n    regex: /^([0-9]{4})April$/,\n    // YYYY\"April\"\n    getPeriods: getFinancialAprilPeriodType(formatYyyyMmDd, filterFuturePeriods),\n    displayName: i18n.t('Financial year (Start April)')\n  }];\n};\nexport const getFixedPeriodType = _ref => {\n  let {\n    periodType,\n    formatYyyyMmDd,\n    filterFuturePeriods\n  } = _ref;\n\n  if (!isValidPeriodType(periodType)) {\n    throw new Error(\"Invalid period type \\\"\".concat(periodType, \"\\\" supplied to \\\"getFixedPeriodType\\\"\"));\n  }\n\n  const periodTypeObj = getFixedPeriodTypes({\n    formatYyyyMmDd,\n    filterFuturePeriods\n  }).find(_ref2 => {\n    let {\n      type\n    } = _ref2;\n    return type === periodType;\n  });\n\n  if (!periodTypeObj) {\n    /**\n     * This error suggests the list of period types at the top of this file\n     * contains a period type name which has not been implemented yet in\n     * getFixedPeriodTypes\n     */\n    throw new Error(\"Could not find periodType object for \\\"\".concat(periodType, \"\\\"\"));\n  }\n\n  return periodTypeObj;\n};\nexport const getYearOffsetFromNow = year => {\n  const yearInt = parseInt(year, 10);\n\n  if (!Number.isInteger(yearInt)) {\n    throw new Error(\"Invalid year \\\"\".concat(year, \"\\\" passed to \\\"getYearOffsetFromNow\\\"\"));\n  }\n\n  return yearInt - getCurrentDate().getFullYear();\n};\nexport const getFixedPeriodsByTypeAndYear = _ref3 => {\n  let {\n    periodType,\n    year,\n    formatYyyyMmDd,\n    filterFuturePeriods,\n    config\n  } = _ref3;\n  const fixedPeriod = getFixedPeriodType({\n    periodType,\n    formatYyyyMmDd,\n    filterFuturePeriods\n  });\n  const offset = getYearOffsetFromNow(year);\n  return fixedPeriod && Number.isInteger(offset) ? fixedPeriod.getPeriods({ ...config,\n    offset\n  }) : [];\n};\nexport const parsePeriodId = (id, allowedTypes) => {\n  if (!id) {\n    return null;\n  }\n\n  const periodTypes = allowedTypes ? getFixedPeriodTypes().filter(_ref4 => {\n    let {\n      type\n    } = _ref4;\n    return allowedTypes.some(allowedType => allowedType === type);\n  }) : getFixedPeriodTypes();\n  let i = 0;\n  let periodType = undefined;\n  let match = undefined;\n\n  while (i < periodTypes.length && !match) {\n    periodType = periodTypes[i];\n    match = id.match(periodType.regex);\n    i++;\n  }\n\n  if (!match) {\n    return null;\n  }\n\n  const year = parseInt(match[1], 10);\n  const offset = getYearOffsetFromNow(year);\n  const periods = periodType.getPeriods({\n    offset\n  });\n  const period = periods.find(period => period.id === id);\n  return { ...period,\n\n    /*\n     * Add year and periodType so a parsed period code\n     * can be use for a multitude of purposes\n     */\n    year,\n    periodType\n  };\n};\n\nconst isValidDate = date => !isNaN(date.getTime());\n\nexport const getFixedPeriodsForTypeAndDateRange = (periodType, startDate, endDate) => {\n  // Allow dates and date-strings\n  startDate = new Date(startDate);\n  endDate = new Date(endDate);\n\n  if (!isValidDate(startDate)) {\n    throw new Error('Invalid startDate provided to getFixedPeriodsForTypeAndDateRange');\n  }\n\n  if (!isValidDate(endDate)) {\n    throw new Error('Invalid endDate provided to getFixedPeriodsForTypeAndDateRange');\n  }\n\n  let year = endDate.getFullYear();\n  let startDateReached = false;\n  const convertedPeriods = [];\n\n  while (!startDateReached) {\n    getFixedPeriodsByTypeAndYear({\n      periodType,\n      year\n    }).reverse().forEach(period => {\n      const periodEnd = new Date(period.endDate); // exclude periods that end before start date\n\n      const endsAfterPeriodStart = periodEnd >= startDate; // exclude periods that end after end date\n\n      const endsBeforePeriodEnd = periodEnd <= endDate;\n\n      if (!endsAfterPeriodStart) {\n        startDateReached = true;\n      }\n\n      if (endsAfterPeriodStart && endsBeforePeriodEnd) {\n        convertedPeriods.push(period);\n      }\n    });\n    --year;\n  }\n\n  return convertedPeriods.reverse();\n};","import { useMemo } from 'react';\nimport { parsePeriodId } from '../fixed-periods/index.js';\nexport default function usePeriod(periodId) {\n  return useMemo(() => parsePeriodId(periodId), [periodId]);\n}","import getMostRecentCompletedYear from './get-most-recent-completed-year.js';\nexport default function computeMaxYear(periodType) {\n  return periodType ? getMostRecentCompletedYear(periodType) : null;\n}","import { getCurrentDate, getFixedPeriodsForTypeAndDateRange, isValidPeriodType } from '../../shared/index.js';\nexport default function getMostRecentCompletedYear(periodType) {\n  if (!isValidPeriodType(periodType)) {\n    throw new Error(\"Invalid periodType \\\"\".concat(periodType, \"\\\" supplied to \\\"getMostRecentCompletedYear\\\"\"));\n  }\n\n  const endDate = getCurrentDate();\n  let year = endDate.getFullYear();\n  let periods = getFixedPeriodsForTypeAndDateRange(periodType, \"\".concat(endDate.getFullYear(), \"-01-01\"), endDate);\n\n  if (periods.length > 0) {\n    return year;\n  } else {\n    /**\n     * Practically speaking we could also just return `year - 1` here\n     * but this logic would allow for periods to span over multiple years\n     */\n    while (periods.length === 0) {\n      --year;\n      periods = getFixedPeriodsForTypeAndDateRange(periodType, \"\".concat(year, \"-01-01\"), \"\".concat(year, \"-12-31\"));\n    }\n\n    return year;\n  }\n}","import { useConfig } from '@dhis2/app-runtime';\nimport { Menu, MenuItem } from '@dhis2/ui';\nimport moment from 'moment';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { getFixedPeriodsByTypeAndYear, usePeriod } from '../../shared/index.js';\nimport { usePeriodId } from '../use-context-selection/index.js';\nimport classes from './period-menu.module.css';\n\nconst getPeriods = _ref => {\n  let {\n    periodType,\n    year,\n    dateFormat\n  } = _ref;\n  return getFixedPeriodsByTypeAndYear({\n    periodType,\n    year,\n    formatYyyyMmDd: date => {\n      if (periodType === 'Daily') {\n        // moment format tokens are case sensitive\n        // see https://momentjs.com/docs/#/parsing/string-format/\n        return moment(date).format(dateFormat.toUpperCase());\n      }\n\n      return moment(date).format('YYYY-MM-DD');\n    },\n    config: {\n      reversePeriods: true\n    }\n  });\n};\n\nexport default function PeriodMenu(_ref2) {\n  let {\n    periodType,\n    year,\n    onChange\n  } = _ref2;\n  const [periodId] = usePeriodId();\n  const selectedPeriod = usePeriod(periodId);\n  const {\n    systemInfo: {\n      dateFormat\n    }\n  } = useConfig();\n  const periods = getPeriods({\n    periodType,\n    year,\n    dateFormat\n  });\n  return /*#__PURE__*/React.createElement(Menu, {\n    dense: true,\n    className: classes.menu\n  }, periods.map(period => /*#__PURE__*/React.createElement(MenuItem, {\n    active: period.id === (selectedPeriod === null || selectedPeriod === void 0 ? void 0 : selectedPeriod.id),\n    key: period.id,\n    label: period.displayName,\n    onClick: () => onChange({\n      selected: period.id\n    })\n  })));\n}\nPeriodMenu.propTypes = {\n  onChange: PropTypes.func.isRequired,\n  periodType: PropTypes.string,\n  year: PropTypes.number\n};","import { useQuery } from 'react-query';\nimport { useDataSetId } from '../use-context-selection/index.js';\nconst QUERY_DATA_SET = {\n  dataSet: {\n    resource: 'dataSets',\n    id: _ref => {\n      let {\n        id\n      } = _ref;\n      return id;\n    },\n    params: {\n      fields: ['periodType']\n    }\n  }\n};\nexport default function useDataSetPeriodType() {\n  const [dataSetId] = useDataSetId();\n  const queryKey = [QUERY_DATA_SET, {\n    id: dataSetId\n  }];\n  const {\n    isLoading: loading,\n    error,\n    data\n  } = useQuery(queryKey, {\n    enabled: !!dataSetId\n  });\n  const dataSetPeriodType = data === null || data === void 0 ? void 0 : data.dataSet.periodType;\n  return {\n    loading,\n    error,\n    data: dataSetPeriodType\n  };\n}","import { Button, IconArrowRight24, IconArrowLeft24 } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport classes from './year-navigator.module.css'; // To avoid users from navigating too far back\n\nconst startYear = 1970;\nexport default function YearNavigator(_ref) {\n  let {\n    maxYear,\n    year,\n    onYearChange\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.container\n  }, /*#__PURE__*/React.createElement(Button, {\n    disabled: year === startYear,\n    onClick: () => onYearChange(year - 1),\n    icon: /*#__PURE__*/React.createElement(IconArrowLeft24, null)\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: classes.year\n  }, year), /*#__PURE__*/React.createElement(Button, {\n    disabled: year === maxYear,\n    onClick: () => onYearChange(year + 1),\n    icon: /*#__PURE__*/React.createElement(IconArrowRight24, null)\n  }));\n}\nYearNavigator.propTypes = {\n  maxYear: PropTypes.number,\n  year: PropTypes.number,\n  onYearChange: PropTypes.func\n};","import i18n from '@dhis2/d2-i18n';\nimport { SelectorBarItem } from '@dhis2/ui';\nimport React, { useEffect, useState } from 'react';\nimport { usePeriod } from '../../shared/index.js';\nimport { useDataSetId, usePeriodId } from '../use-context-selection/index.js';\nimport computeMaxYear from './compute-max-year.js';\nimport PeriodMenu from './period-menu.js';\nimport useDataSetPeriodType from './use-data-set-period-type.js';\nimport useDeselectOnPeriodTypeChange from './use-deselect-on-period-type-change.js';\nimport useSelectorBarItemValue from './use-select-bar-item-value.js';\nimport YearNavigator from './year-navigator.js';\nexport const PERIOD = 'PERIOD';\nexport const PeriodSelectorBarItem = () => {\n  const [periodOpen, setPeriodOpen] = useState(false);\n  const [periodId, setPeriodId] = usePeriodId();\n  const [dataSetId] = useDataSetId();\n  const dataSetPeriodType = useDataSetPeriodType();\n  const [maxYear, setMaxYear] = useState(() => computeMaxYear(dataSetPeriodType.data));\n  const selectedPeriod = usePeriod(periodId);\n  const [year, setYear] = useState((selectedPeriod === null || selectedPeriod === void 0 ? void 0 : selectedPeriod.year) || maxYear);\n  useEffect(() => {\n    if (selectedPeriod !== null && selectedPeriod !== void 0 && selectedPeriod.year) {\n      setYear(selectedPeriod.year);\n    }\n  }, [selectedPeriod === null || selectedPeriod === void 0 ? void 0 : selectedPeriod.year]);\n  useEffect(() => {\n    if (dataSetPeriodType.data) {\n      const newMaxYear = computeMaxYear(dataSetPeriodType.data);\n      setMaxYear(newMaxYear);\n\n      if (!(selectedPeriod !== null && selectedPeriod !== void 0 && selectedPeriod.year)) {\n        setYear(newMaxYear);\n      }\n    }\n  }, [dataSetPeriodType.data]);\n  const selectorBarItemValue = useSelectorBarItemValue();\n  useDeselectOnPeriodTypeChange();\n  return /*#__PURE__*/React.createElement(SelectorBarItem, {\n    disabled: !dataSetId,\n    label: i18n.t('Period'),\n    value: periodId ? selectorBarItemValue : undefined,\n    open: periodOpen,\n    setOpen: setPeriodOpen,\n    noValueMessage: i18n.t('Choose a period')\n  }, year ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(YearNavigator, {\n    maxYear: maxYear,\n    year: year,\n    onYearChange: year => {\n      setPeriodId(null);\n      setYear(year);\n    }\n  }), /*#__PURE__*/React.createElement(PeriodMenu, {\n    onChange: _ref => {\n      let {\n        selected\n      } = _ref;\n      setPeriodId(selected);\n      setPeriodOpen(false);\n    },\n    periodType: dataSetPeriodType.data,\n    year: year\n  })) : /*#__PURE__*/React.createElement(\"div\", null));\n};","import i18n from '@dhis2/d2-i18n';\nimport { usePeriod } from '../../shared/index.js';\nimport { usePeriodId } from '../use-context-selection/index.js';\nimport useDataSetPeriodType from './use-data-set-period-type.js';\nexport default function useSelectorBarItemValue() {\n  const [periodId] = usePeriodId();\n  const dataSetPeriodType = useDataSetPeriodType();\n  const selectedPeriod = usePeriod(periodId);\n\n  if (dataSetPeriodType.loading) {\n    return i18n.t('Fetching data set info');\n  }\n\n  if (dataSetPeriodType.error) {\n    return i18n.t('Error occurred while loading data set info');\n  }\n\n  return selectedPeriod === null || selectedPeriod === void 0 ? void 0 : selectedPeriod.displayName;\n}","import { useEffect, useState, useRef } from 'react';\nimport { useDataSetPeriodType } from '../period-selector-bar-item/index.js';\nimport { useAttributeOptionComboSelection, useDataSetId } from '../use-context-selection/index.js';\n/**\n * If the period type changes, we need to deselect the current selection. As\n * the different selectors should be self-contained / isolated, I put this\n * logic into the category option combo module\n */\n\nexport default function useDeselectOnPeriodTypeChange() {\n  const initialExecution = useRef(true);\n  const [previousPeriodType, setPreviousPeriodType] = useState('');\n  const [dataSetId] = useDataSetId();\n  const {\n    loadingDataSetPeriodType,\n    errorDataSetPeriodType,\n    periodType\n  } = useDataSetPeriodType();\n  const [, setAttributeOptionComboSelection] = useAttributeOptionComboSelection();\n  useEffect(() => {\n    if (initialExecution.current) {\n      initialExecution.current = false;\n    } else if (!loadingDataSetPeriodType && !errorDataSetPeriodType && previousPeriodType !== periodType) {\n      setAttributeOptionComboSelection([]);\n      setPreviousPeriodType(periodType);\n    }\n  }, [loadingDataSetPeriodType, errorDataSetPeriodType, dataSetId, initialExecution, previousPeriodType]);\n}","import { useQuery } from 'react-query';\nimport { useDataSetId } from '../use-context-selection/index.js';\nconst QUERY_DATA_SET_SECTIONS_INFO = {\n  dataSet: {\n    resource: 'dataSets',\n    id: _ref => {\n      let {\n        id\n      } = _ref;\n      return id;\n    },\n    params: {\n      fields: ['formType', 'sections[id,displayName]']\n    }\n  }\n};\nexport default function useDataSetSectionsInfo() {\n  const [dataSetId] = useDataSetId();\n  const queryKey = [QUERY_DATA_SET_SECTIONS_INFO, {\n    id: dataSetId\n  }];\n  const {\n    isIdle,\n    isLoading: loading,\n    error,\n    data\n  } = useQuery(queryKey, {\n    enabled: !!dataSetId\n  });\n  const dataSet = data === null || data === void 0 ? void 0 : data.dataSet;\n  return {\n    called: !isIdle,\n    data: dataSet,\n    loading,\n    error\n  };\n}","import i18n from '@dhis2/d2-i18n';\nimport { SelectorBarItem } from '@dhis2/ui';\nimport React, { useState } from 'react';\nimport { MenuSelect } from '../menu-select/index.js';\nimport { useSectionFilter } from '../use-context-selection/index.js';\nimport useDataSetSectionsInfo from './use-data-set-sections-info.js';\nimport useOnDependentParamsChange from './use-on-dependent-params-change.js';\nimport useSelectorBarItemValue from './use-selector-bar-item-value.js';\nimport useShouldComponentRenderNull from './use-should-component-render-null.js';\nexport default function SectionFilterSelectorBarItem() {\n  var _dataSetSectionsInfo$;\n\n  const [open, setOpen] = useState(false);\n  const [sectionFilter, setSectionFilter] = useSectionFilter();\n\n  const deselect = () => setSectionFilter(undefined);\n\n  const dataSetSectionsInfo = useDataSetSectionsInfo();\n  const loading = !dataSetSectionsInfo.called || dataSetSectionsInfo.loading;\n  const sectionFilterValue = useSelectorBarItemValue();\n  useOnDependentParamsChange(deselect);\n  const shouldComponentRenderNull = useShouldComponentRenderNull();\n\n  if (shouldComponentRenderNull) {\n    return null;\n  }\n\n  const renderMenu = !dataSetSectionsInfo.loading && !dataSetSectionsInfo.error && dataSetSectionsInfo.data;\n  const sectionOptions = ((_dataSetSectionsInfo$ = dataSetSectionsInfo.data) === null || _dataSetSectionsInfo$ === void 0 ? void 0 : _dataSetSectionsInfo$.sections.map(_ref => {\n    let {\n      id,\n      displayName\n    } = _ref;\n    return {\n      value: id,\n      label: displayName\n    };\n  })) || [];\n  const selectableOptions = [{\n    value: '',\n    label: i18n.t('Show all sections')\n  }, ...sectionOptions];\n  return /*#__PURE__*/React.createElement(SelectorBarItem, {\n    disabled: loading || dataSetSectionsInfo.error,\n    label: i18n.t('Section filter'),\n    value: sectionFilterValue,\n    open: open,\n    setOpen: setOpen,\n    noValueMessage: i18n.t('Choose a section filter')\n  }, renderMenu ? /*#__PURE__*/React.createElement(MenuSelect, {\n    values: selectableOptions,\n    selected: sectionFilter,\n    onChange: _ref2 => {\n      let {\n        selected\n      } = _ref2;\n      setSectionFilter(selected);\n      setOpen(false);\n    }\n  }) : /*#__PURE__*/React.createElement(\"div\", null));\n}","import i18n from '@dhis2/d2-i18n';\nimport { useSectionFilter } from '../use-context-selection/index.js';\nimport useDataSetSectionsInfo from './use-data-set-sections-info.js';\nexport default function useSelectorBarItemValue() {\n  const [sectionFilter] = useSectionFilter();\n  const dataSetSectionsInfo = useDataSetSectionsInfo();\n\n  if (!sectionFilter) {\n    return undefined;\n  }\n\n  const loading = !dataSetSectionsInfo.called || dataSetSectionsInfo.loading;\n\n  if (loading) {\n    return i18n.t('Fetching data set info');\n  }\n\n  if (dataSetSectionsInfo.error) {\n    return i18n.t('Error occurred while loading data set info');\n  }\n\n  if (!dataSetSectionsInfo.data) {\n    return undefined;\n  }\n\n  const {\n    sections\n  } = dataSetSectionsInfo.data;\n  const selectedSection = sections.find(_ref => {\n    let {\n      id\n    } = _ref;\n    return id === sectionFilter;\n  });\n  return selectedSection === null || selectedSection === void 0 ? void 0 : selectedSection.displayName;\n}","import { useEffect, useRef } from 'react';\nimport { useAttributeOptionComboSelection, useDataSetId, useOrgUnitId, usePeriodId } from '../use-context-selection/index.js';\nexport default function useOnDependentParamsChange(cb) {\n  const initialExecution = useRef(true);\n  const [dataSetId] = useDataSetId();\n  const [periodId] = usePeriodId();\n  const [orgUnitId] = useOrgUnitId();\n  const [attributeOptionComboSelection] = useAttributeOptionComboSelection();\n  useEffect(() => {\n    if (initialExecution.current) {\n      initialExecution.current = false;\n    } else {\n      cb();\n    }\n  }, [dataSetId, orgUnitId, periodId, attributeOptionComboSelection]);\n}","import useDataSetSectionsInfo from './use-data-set-sections-info.js';\n/*\n * `dataSetSectionsInfo.loading` does not mean that \"null\" should be rendered.\n * This happens automatically during the first loading as\n * `'SECTION' !== dataSetSectionsInfo.data?.formType` resolves to `true`.\n *\n * But when data is stale and this function has determined that the component\n * should not render `null`, then it's most likely not going to change when\n * reloading\n */\n\nexport default function useShouldComponentRenderNull() {\n  var _dataSetSectionsInfo$, _dataSetSectionsInfo$2;\n\n  const dataSetSectionsInfo = useDataSetSectionsInfo();\n  return !dataSetSectionsInfo.called || 'SECTION' !== ((_dataSetSectionsInfo$ = dataSetSectionsInfo.data) === null || _dataSetSectionsInfo$ === void 0 ? void 0 : _dataSetSectionsInfo$.formType) || ((_dataSetSectionsInfo$2 = dataSetSectionsInfo.data) === null || _dataSetSectionsInfo$2 === void 0 ? void 0 : _dataSetSectionsInfo$2.sections.length) === 0;\n}","import { SelectorBar } from '@dhis2/ui';\nimport React from 'react';\nimport { AttributeOptionComboSelectorBarItem } from '../attribute-option-combo-selector-bar-item/index.js';\nimport { DataSetSelectorBarItem } from '../data-set-selector-bar-item/index.js';\nimport { OrgUnitSetSelectorBarItem } from '../org-unit-selector-bar-item/index.js';\nimport { PeriodSelectorBarItem } from '../period-selector-bar-item/index.js';\nimport { SectionFilterSelectorBarItem } from '../section-filter-selector-bar-item/index.js';\nimport { useClearEntireSelection } from '../use-context-selection/index.js';\nimport useShouldHideClearButton from './use-should-hide-clear-button.js';\nexport default function ContextSelector() {\n  const hideClearButton = useShouldHideClearButton();\n  const clearEntireSelection = useClearEntireSelection();\n  const onClearSelectionClick = hideClearButton ? undefined : clearEntireSelection;\n  return /*#__PURE__*/React.createElement(SelectorBar, {\n    onClearSelectionClick: onClearSelectionClick\n  }, /*#__PURE__*/React.createElement(DataSetSelectorBarItem, null), /*#__PURE__*/React.createElement(OrgUnitSetSelectorBarItem, null), /*#__PURE__*/React.createElement(PeriodSelectorBarItem, null), /*#__PURE__*/React.createElement(AttributeOptionComboSelectorBarItem, null), /*#__PURE__*/React.createElement(SectionFilterSelectorBarItem, null));\n}","import { useContextSelection } from '../use-context-selection/index.js';\nexport default function useShouldHideClearButton() {\n  const [selection] = useContextSelection();\n\n  if (!selection.orgUnitId && !selection.periodId && !selection.attributeOptionComboSelection.length && !selection.sectionFilter) {\n    return true;\n  }\n\n  return false;\n}","import classnames from 'classnames';\nimport { node, bool } from 'prop-types';\nimport React from 'react';\nimport css from './layout.module.css';\n\nconst Layout = _ref => {\n  let {\n    header,\n    main,\n    sidebar,\n    footer,\n    showSidebar,\n    showFooter\n  } = _ref;\n  const wrapperClass = classnames(css.wrapper, {\n    [css.showSidebar]: showSidebar,\n    [css.showFooter]: showFooter\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: wrapperClass\n  }, /*#__PURE__*/React.createElement(\"header\", {\n    className: css.header\n  }, header), /*#__PURE__*/React.createElement(\"main\", {\n    className: css.main\n  }, main), /*#__PURE__*/React.createElement(\"aside\", {\n    className: css.sidebar\n  }, sidebar), showFooter && /*#__PURE__*/React.createElement(\"footer\", {\n    className: css.footer\n  }, footer));\n};\n\nLayout.propTypes = {\n  footer: node,\n  header: node,\n  main: node,\n  showFooter: bool,\n  showSidebar: bool,\n  sidebar: node\n};\nexport default Layout;","import { useDataEngine } from '@dhis2/app-runtime';\nimport { QueryClient } from 'react-query';\n\nconst useQueryClient = () => {\n  const engine = useDataEngine(); // https://react-query.tanstack.com/guides/query-keys\n\n  const queryFn = _ref => {\n    let {\n      queryKey\n    } = _ref;\n    const [query, variables] = queryKey;\n    return engine.query(query, {\n      variables\n    });\n  }; // https://react-query.tanstack.com/guides/default-query-function\n\n\n  const queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        queryFn\n      }\n    }\n  });\n  return queryClient;\n};\n\nexport default useQueryClient;","import { CssVariables } from '@dhis2/ui';\nimport React from 'react';\nimport { QueryClientProvider } from 'react-query';\nimport { HashRouter as Router, Route } from 'react-router-dom';\nimport { QueryParamProvider } from 'use-query-params';\nimport './app.css';\nimport { ContextSelection } from '../context-selection/index.js';\nimport { Layout } from './layout/index.js';\nimport useQueryClient from './use-query-client.js';\n/**\n * \"use-query-params\" requires a router. It suggests react-router-dom in the\n * docs, so that's why I chose that one. Unfortunately it doesn't work with\n * react-router-dom@6, so I have do go with react-router-dom@^5\n */\n\nconst App = () => {\n  const queryClient = useQueryClient();\n  return /*#__PURE__*/React.createElement(QueryClientProvider, {\n    client: queryClient\n  }, /*#__PURE__*/React.createElement(Router, null, /*#__PURE__*/React.createElement(QueryParamProvider, {\n    ReactRouterRoute: Route\n  }, /*#__PURE__*/React.createElement(CssVariables, {\n    colors: true,\n    spacers: true\n  }), /*#__PURE__*/React.createElement(Layout, {\n    header: /*#__PURE__*/React.createElement(ContextSelection, null),\n    main: \"\",\n    sidebar: \"\",\n    footer: \"\",\n    showSidebar: true,\n    showFooter: true\n  }))));\n};\n\nexport default App;"],"sourceRoot":""}